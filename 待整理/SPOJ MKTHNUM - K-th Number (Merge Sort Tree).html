<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600986 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <meta name="application-data:2525275" content="10389191/s94/d4e7cea2-75a3-49ce-9656-af2860bd04bf/www.evernote.com"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="500"/>

<div>
<span><div><a href="http://www.spoj.com/problems/MKTHNUM/">http://www.spoj.com/problems/MKTHNUM/</a><br/></div><div><br/></div><div><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">线段树，</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">Merge Sort Tree, MST</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">题意：一个数组有</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">N</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">个元素</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">(N &lt;= 1e5), </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">现有</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">Q</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">个</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">query(Q &lt;= 5000), </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">每个</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">query</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">查询数组</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">[L, R]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">区间内第</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">K</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">大的数字</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">思路：构造</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">MST</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">MST</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">的结构类似线段树，每个节点保存所有孩子元素排序后的数组，使用归并排序进行处理。空间要求</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">O(NlogN)</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，排序时间</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">O(NlogN)</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">对于每个</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">query</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，查询过程如下：</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// 1. </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">对数组</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">N</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">排序</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// 2. </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">猜想</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">[L, R]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">范围内第</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">K</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">大的数字是</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">X</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">X</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">的取值通过二分从排序后的数组中获取</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// 3. </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">在线段树内查询</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">[L, R]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">范围内</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00"> &lt;=X </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">的元素个数，在本节点内</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">vector</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">二分查找</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">(</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">如果范围匹配</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">)</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">或者在子节点查找，深度</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">O(logN)</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，查询复杂度</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">O(logN)</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// 4. </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">如果</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">step-3 </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">查出</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00"> &lt;= X</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">的元素个数</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">count &lt; K</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，说明</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">X</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">取值太小，返回</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">step-2</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">对右半部进行二分猜想；如果</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">count &gt;= K</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">则对左半部进行二分猜想；需要注意的是即使</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">count == K</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">不能说明</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">X</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">就是所求的数字，因为</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">X</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">可能压根不在</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">[L, R]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">区域内。距离</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">[L, R]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">区域是</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">[5 2 7 3]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，第</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">3</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">大的数字是</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">5</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，但是猜想是</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">6</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">时，同样有</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00"> &lt;= 6</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">的数字个数</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">=3</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">。过程类似</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">lower_bound</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">step-2</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">需要跑满</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">logN</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">次</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">整体复杂度</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00"> O(NlogN + Q*logN*logN*logN)</span><br/></div><div><br/></div><div>merge sorted tree (MST)</div><div><div></div><div><a href="https://discuss.codechef.com/questions/94448/merge-sort-tree-tutorial">https://discuss.codechef.com/questions/94448/merge-sort-tree-tutorial</a><br/></div><div>类似线段树结构，每个节点归并排序子节点的数值(节点内容开销综合O(NlogN))</div></div><div>查询[L, R]范围内比K小的值，在O(logN *logN)的时间内完成(路径上每个节点二分查找)</div><div><a href="SPOJ MKTHNUM - K-th Number (Merge Sort Tree)_files/SPOJ_MKTHNUM.cpp"><img src="SPOJ MKTHNUM - K-th Number (Merge Sort Tree)_files/c48558d80c554cbd5ab3e886886a39c3.png" alt="SPOJ_MKTHNUM.cpp"></a><br/></div><div><br/></div><div><br/></div><div><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">主席树，</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">Persistent Segment Tree</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">题意：一个数组</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">A</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">有</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">N</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">个元素</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">(N &lt;= 1e5), </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">现有</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">Q</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">个</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">query(Q &lt;= 5000), </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">每个</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">query</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">查询数组</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">[L, R]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">区间内第</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">K</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">大的数字</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">思路（解法</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">2</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">）：</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">创建一个计数用数组</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">B</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，长度和</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">A</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">相同，</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">B[i] = 1</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">时，表示</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">A[i]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">元素已经出现</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">在数组</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">B</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">上建立线段树，按照</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">A[i]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">数字从小到大顺序更新</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">B</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">的相应位置，总共会更新</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">N</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">次；初始状态</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">B = [0,0,...,0], </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">更新</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">N</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">次后</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">B = [1,1,...,1]</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">线段树上支持查询</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">Count(L, R)</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，返回</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">sigma(B[i]) [i=L...R]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，即对</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">[L, R]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">区间内的元素进行计数，看有多少元素已经出现</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">比如对于数组</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00"> A=[3,2,1,4]</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//    </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">第一次更新后</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">B=[0,0,1,0], Count(1,2)=0, Count(1,3)=1</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//    </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">第二次更新后</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">B=[0,1,1,0], Count(1,2)=1, Count(1,3)=2</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">线段树总共更新</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">N</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">次，假如我们能够访问任意一次更新</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">(</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">设为第</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">K</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">次</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">)</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">后</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">Count(L, R)</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">的值，就能够使用二分法确定使</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">Count(L, R) == X</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">的</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">K</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">值，即线段树在进行完第</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">K</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">次更新后，刚好使</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">Count(L, R) == X</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，即</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">[L, R]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">区域内刚好有</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">X</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">个数字出现过。这个时候，我们可以判定第</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">K</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">次更新的数字，就是在</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">[L, R]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">区域内第</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">X</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">大的数字</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">所得即题目的</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">Q(L, R, X)</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">如何能够访问任意一次更新后的线段树？</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">使用</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">Persistent Segment Tree</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，可在</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">O(NlogN)</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">的时间和空间复杂度内，完成对线段树各版本的记录。所有版本的入口记录在</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">root[]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">数组中，</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">root[0]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">表示未更新的线段树入口，即</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">B = [0,0,...,0]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">root[1]</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">表示更新一次后的线段树入口</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">一次</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">Query</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">需要进行二分猜测</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">K</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">值，</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">O(logN)</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">；每次猜测后需要</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">O(logN)</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">时间计算</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">Count</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">整体复杂是</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00"> O(NlogN + M * logN * logN)</span><br/></div><div><a href="SPOJ MKTHNUM - K-th Number (Merge Sort Tree)_files/SPOJ_MKTHNUM_Persistent.cpp"><img src="SPOJ MKTHNUM - K-th Number (Merge Sort Tree)_files/75a3fc04822dd553dbfaac7fa4b62dd8.png" alt="SPOJ_MKTHNUM_Persistent.cpp"></a><br/></div><div><br/></div><div><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">解法</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">3</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">：基于解法</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">2</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">，通过合并线段树优化查询时间，理论上查询时间复杂度从</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00"> O(M * logN * logN) </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">变成</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00"> O(M * logN)</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000"><br/>
</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">// </span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">但是可能由于</span><span style="font: 11.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">compressed map</span><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00">的构造比较费事，运行反而增加了</span><br/></div><div><span style="font: 11.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #008f00"><a href="SPOJ MKTHNUM - K-th Number (Merge Sort Tree)_files/SPOJ_MKTHNUM_Persistent_2.cpp"><img src="SPOJ MKTHNUM - K-th Number (Merge Sort Tree)_files/59fd60c4726e8e709b3ca5d00584ab82.png" alt="SPOJ_MKTHNUM_Persistent_2.cpp"></a><br/></span></div><div><br/></div></span>
</div></body></html> 